"use strict";(self["webpackChunkmushop"]=self["webpackChunkmushop"]||[]).push([[637],{2698:function(s,t,e){e.d(t,{R:function(){return a}});var o=e(2119);const a=()=>{const s=(0,o.tv)(),t=()=>{s.back()};return{toBack:t}}},5143:function(s,t,e){e.d(t,{V:function(){return c}});var o=e(6252),a=e(3907);const c=s=>{const t=(0,a.oR)(),e=t.state.cartList,c=(s,e,o,a)=>{t.commit("changeItemQuantity",{shopId:s,productId:e,item:o,num:a})},n=(0,o.Fl)((()=>{const t=e[s]?.productList||{};let o={};for(let s in t){const e=t[s];e.count>0&&(o[s]=e)}return o})),r=(0,o.Fl)((()=>{const t=e[s]?.productList||{};let o={};for(let s in t){const e=t[s];e.check&&e.count>0&&(o[s]=e)}return o})),i=(0,o.Fl)((()=>e[s]?.shopName||"")),u=(0,o.Fl)((()=>{const t=e[s]?.productList;let o={total:0,sum:0,allChecked:!0};if(t)for(const s in t){const e=t[s];o.total+=e.count,e.check&&(o.sum+=e.price*e.count),e.count>0&&!e.check&&(o.allChecked=!1)}return o.sum=o.sum.toFixed(2),o}));return{cartList:e,productList:n,Calculations:u,shopName:i,orderedProductList:r,changeItemQuantity:c}}},4179:function(s,t,e){e.d(t,{Z:function(){return _},S:function(){return i}});var o=e(6252),a=e(3577);const c={class:"toast"};function n(s,t,e,n,r,i){return(0,o.wg)(),(0,o.iD)("div",c,(0,a.zw)(e.message),1)}var r=e(2262);const i=()=>{const s=(0,r.qj)({toastMessage:"",show:!1}),t=t=>{s.show=!0,s.toastMessage=t,setTimeout((()=>{s.show=!1}),2e3)},{toastMessage:e,show:o}=(0,r.BK)(s);return{toastMessage:e,show:o,showToast:t}};var u={name:"ToastPart",props:["message"]},d=e(3744);const l=(0,d.Z)(u,[["render",n],["__scopeId","data-v-f70ca294"]]);var _=l},7808:function(s,t,e){e.r(t),e.d(t,{default:function(){return os}});var o=e(6252);const a={class:"wrapper"};function c(s,t,e,c,n,r){const i=(0,o.up)("TopArea"),u=(0,o.up)("OrderProduct"),d=(0,o.up)("OrderPart");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",a,[(0,o.Wm)(i),(0,o.Wm)(u,{productList:c.productList,shopName:c.shopName,Calculations:c.Calculations},null,8,["productList","shopName","Calculations"])]),(0,o.Wm)(d)],64)}var n=e(2119),r=e(5143),i=e(3577);const u=s=>((0,o.dD)("data-v-3709fb78"),s=s(),(0,o.Cn)(),s),d={key:0,class:"product"},l={class:"product__header"},_={key:0,class:"product__item"},p=["src"],m={class:"product__item__detail"},v={class:"product__item__title"},h={class:"product__item__price"},f=u((()=>(0,o._)("em",null,"￥",-1))),k=u((()=>(0,o._)("em",null,"×",-1))),w={class:"product__item__sum"},C=(0,o.Uk)("￥");function g(s,t,e,a,c,n){return e.Calculations.total>0?((0,o.wg)(),(0,o.iD)("div",d,[(0,o._)("h3",l,(0,i.zw)(e.shopName),1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.productList,(s=>((0,o.wg)(),(0,o.iD)(o.HY,{key:s._id},[s.check?((0,o.wg)(),(0,o.iD)("div",_,[(0,o._)("img",{class:"product__item__img",src:s.imgUrl},null,8,p),(0,o._)("div",m,[(0,o._)("h4",v,(0,i.zw)(s.name),1),(0,o._)("p",h,[f,(0,o._)("i",null,(0,i.zw)(s.price),1),k,(0,o._)("i",null,(0,i.zw)(s.count),1),(0,o._)("span",w,[C,(0,o._)("i",null,(0,i.zw)((s.price*s.count).toFixed(2)),1)])])])])):(0,o.kq)("",!0)],64)))),128))])):(0,o.kq)("",!0)}var b={name:"OrderProduct",props:["productList","shopName","Calculations"]},L=e(3744);const O=(0,L.Z)(b,[["render",g],["__scopeId","data-v-3709fb78"]]);var y=O,I=e(9963);const D=s=>((0,o.dD)("data-v-52ecb0ad"),s=s(),(0,o.Cn)(),s),N={class:"order"},P={class:"order__price"},B=(0,o.Uk)(" 实付金额 "),T=D((()=>(0,o._)("h2",{class:"confirmation__title"},"确认要离开收银台？",-1))),M=D((()=>(0,o._)("p",{class:"confirmation__notice"},"请尽快完成支付，否则将被取消",-1))),z={class:"confirmation__btn"},Z={class:"success"},q=D((()=>(0,o._)("div",{class:"success__icon iconfont"},"",-1))),F=D((()=>(0,o._)("p",{class:"success__notice"},"支付成功，等待配送",-1)));function H(s,t,e,a,c,n){const r=(0,o.up)("ToastPart");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",N,[(0,o._)("div",P,[B,(0,o._)("b",null,"¥"+(0,i.zw)(a.Calculations.sum),1)]),(0,o._)("div",{class:"order__btn",onClick:t[0]||(t[0]=()=>a.handlesubmitOrder(!0))}," 提交订单 ")]),a.showConfirm?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"mask",onClick:t[4]||(t[4]=()=>a.handlesubmitOrder(!1))},[(0,o._)("div",{class:"confirmation",onClick:t[3]||(t[3]=(0,I.iM)((()=>{}),["stop"]))},[T,M,(0,o._)("div",z,[(0,o._)("button",{class:"confirmation__btn__cancel",onClick:t[1]||(t[1]=()=>a.postConfirmOrder(!0))}," 取消订单 "),(0,o._)("button",{class:"confirmation__btn__confir",onClick:t[2]||(t[2]=()=>a.postConfirmOrder(!1))}," 确认支付 ")])])])):(0,o.kq)("",!0),a.showSuccess?((0,o.wg)(),(0,o.iD)("div",{key:1,class:"mask",onClick:t[6]||(t[6]=(...s)=>a.toBack&&a.toBack(...s))},[(0,o._)("div",Z,[q,(0,o._)("div",{class:"success__x iconfont",onClick:t[5]||(t[5]=()=>s.handlepayment(!1))},""),F])])):(0,o.kq)("",!0),a.show?((0,o.wg)(),(0,o.j4)(r,{key:2,message:a.toastMessage},null,8,["message"])):(0,o.kq)("",!0)],64)}var S=e(2262),R=e(3907),j=e(4471),U=e(2698),Y=e(4179);const x=()=>{const s=(0,S.iH)(!1),t=t=>{s.value=t},e=(0,S.iH)(!1),o=t=>{s.value=!1,e.value=t};return{showConfirm:s,handlesubmitOrder:t,showSuccess:e,handlepayment:o}},A=(s,t,e,o,a)=>{const c=(0,n.tv)(),r=(0,R.oR)(),i=async n=>{const i=[];for(let s in e.value){const t=e.value[s];i.push({id:parseInt(t._id,10),num:t.count})}try{const e=await(0,j.v)("/api/order",{addressId:1,shopId:s,shopName:t.value,isCanceled:n,products:i});0===e?.errno&&(r.commit("clearOrderedItem",s),n?c.push({name:"orderList"}):(a(!0),setTimeout((()=>{c.push({name:"orderList"})}),1500)))}catch(u){o("请求失败")}};return{postConfirmOrder:i}};var V={name:"OrderPart",components:{ToastPart:Y.Z},setup(){const{toBack:s}=(0,U.R)(),{toastMessage:t,show:e,showToast:o}=(0,Y.S)(),{showConfirm:a,handlesubmitOrder:c,showSuccess:i,handlepayment:u}=x(),d=(0,n.yj)(),l=parseInt(d.params.id,10),{shopName:_,orderedProductList:p,Calculations:m}=(0,r.V)(l),{postConfirmOrder:v}=A(l,_,p,o,u);return{toastMessage:t,show:e,toBack:s,Calculations:m,showConfirm:a,handlesubmitOrder:c,postConfirmOrder:v,showSuccess:i}}};const W=(0,L.Z)(V,[["render",H],["__scopeId","data-v-52ecb0ad"]]);var K=W;const Q={class:"top"},E=(0,o.Uk)("确认订单 "),G=(0,o.uE)('<div class="receiver" data-v-7138ec1e><p class="receiver__title" data-v-7138ec1e>收货地址</p><p class="receiver__address" data-v-7138ec1e> 北京理工大学国防科技园2号楼10层 <span class="iconfont receiver__icon" data-v-7138ec1e></span></p><p class="receiver__info" data-v-7138ec1e><span class="receiver__info__name" data-v-7138ec1e>瑶妹（先生）</span><span class="receiver__info__number" data-v-7138ec1e>18911024266</span></p></div>',1);function J(s,t,e,a,c,n){return(0,o.wg)(),(0,o.iD)("div",Q,[(0,o._)("h2",null,[(0,o._)("span",{class:"top__back iconfont",onClick:t[0]||(t[0]=(...s)=>a.toBack&&a.toBack(...s))},""),E]),G])}var X={name:"TopArea",setup(){const{toBack:s}=(0,U.R)();return{toBack:s}}};const $=(0,L.Z)(X,[["render",J],["__scopeId","data-v-7138ec1e"]]);var ss=$,ts={name:"orderConfirmation",components:{OrderProduct:y,OrderPart:K,TopArea:ss},setup(){const s=(0,n.yj)(),t=s.params.id,{productList:e,Calculations:o,shopName:a}=(0,r.V)(t);return{productList:e,Calculations:o,shopName:a}}};const es=(0,L.Z)(ts,[["render",c],["__scopeId","data-v-da96905a"]]);var os=es}}]);
//# sourceMappingURL=order.76ef5f7b.js.map